Iteration 0: 100%|██████████| 15/15 [00:34<00:00,  2.28s/it, episode=10, norm_ret=-10.864, true_ret=-924973.812, steps=600]
Agent gate_2 episode reward: [-46.62086365]
All agents episode reward: [-46.62086365]
Agent gate_2 episode reward: [-7.95097878]
All agents episode reward: [-7.95097878]
Agent gate_2 episode reward: [-4.91823872]
All agents episode reward: [-4.91823872]
Agent gate_2 episode reward: [-4.50667797]
All agents episode reward: [-4.50667797]
Agent gate_2 episode reward: [-4.6223836]
All agents episode reward: [-4.6223836]
Agent gate_2 episode reward: [-5.28664574]
All agents episode reward: [-5.28664574]
Agent gate_2 episode reward: [-7.28000722]
All agents episode reward: [-7.28000722]
Agent gate_2 episode reward: [-8.33202289]
All agents episode reward: [-8.33202289]
Agent gate_2 episode reward: [-9.62562839]
All agents episode reward: [-9.62562839]
Agent gate_2 episode reward: [-9.49401218]
All agents episode reward: [-9.49401218]
Agent gate_2 episode reward: [-10.36064279]
All agents episode reward: [-10.36064279]
Agent gate_2 episode reward: [-9.98653919]
All agents episode reward: [-9.98653919]
Agent gate_2 episode reward: [-9.35803927]
All agents episode reward: [-9.35803927]
Agent gate_2 episode reward: [-8.48247954]
All agents episode reward: [-8.48247954]
Agent gate_2 episode reward: [-9.74745086]
All agents episode reward: [-9.74745086]
Iteration 1: 100%|██████████| 15/15 [00:34<00:00,  2.28s/it, episode=25, norm_ret=-8.860, true_ret=-647357.438, steps=600]
Agent gate_2 episode reward: [-8.90373006]
All agents episode reward: [-8.90373006]
Agent gate_2 episode reward: [-8.05251595]
All agents episode reward: [-8.05251595]
Agent gate_2 episode reward: [-7.45764859]
All agents episode reward: [-7.45764859]
Agent gate_2 episode reward: [-8.15939336]
All agents episode reward: [-8.15939336]
Agent gate_2 episode reward: [-11.14589275]
All agents episode reward: [-11.14589275]
Agent gate_2 episode reward: [-10.26097277]
All agents episode reward: [-10.26097277]
Agent gate_2 episode reward: [-8.74880327]
All agents episode reward: [-8.74880327]
Agent gate_2 episode reward: [-8.09883134]
All agents episode reward: [-8.09883134]
Agent gate_2 episode reward: [-8.71781262]
All agents episode reward: [-8.71781262]
Agent gate_2 episode reward: [-9.05912984]
All agents episode reward: [-9.05912984]
Agent gate_2 episode reward: [-7.8711905]
All agents episode reward: [-7.8711905]
Agent gate_2 episode reward: [-9.85168185]
All agents episode reward: [-9.85168185]
Agent gate_2 episode reward: [-10.67277601]
All agents episode reward: [-10.67277601]
Agent gate_2 episode reward: [-13.24884405]
All agents episode reward: [-13.24884405]
Agent gate_2 episode reward: [-10.53553469]
All agents episode reward: [-10.53553469]
Iteration 2: 100%|██████████| 15/15 [00:34<00:00,  2.29s/it, episode=40, norm_ret=-10.416, true_ret=-706281.062, steps=600]
Agent gate_2 episode reward: [-9.93826061]
All agents episode reward: [-9.93826061]
Agent gate_2 episode reward: [-10.7897321]
All agents episode reward: [-10.7897321]
Agent gate_2 episode reward: [-12.83753523]
All agents episode reward: [-12.83753523]
Agent gate_2 episode reward: [-13.84733908]
All agents episode reward: [-13.84733908]
Agent gate_2 episode reward: [-8.42878128]
All agents episode reward: [-8.42878128]
Agent gate_2 episode reward: [-9.17946361]
All agents episode reward: [-9.17946361]
Agent gate_2 episode reward: [-9.78869781]
All agents episode reward: [-9.78869781]
Agent gate_2 episode reward: [-9.47537844]
All agents episode reward: [-9.47537844]
Agent gate_2 episode reward: [-8.52941409]
All agents episode reward: [-8.52941409]
Agent gate_2 episode reward: [-11.35007241]
All agents episode reward: [-11.35007241]
Agent gate_2 episode reward: [-9.7739379]
All agents episode reward: [-9.7739379]
Agent gate_2 episode reward: [-10.62876853]
All agents episode reward: [-10.62876853]
Agent gate_2 episode reward: [-10.59450033]
All agents episode reward: [-10.59450033]
Agent gate_2 episode reward: [-10.11969495]
All agents episode reward: [-10.11969495]
Agent gate_2 episode reward: [-14.61627859]
All agents episode reward: [-14.61627859]
Iteration 3: 100%|██████████| 15/15 [00:34<00:00,  2.27s/it, episode=55, norm_ret=-11.668, true_ret=-808351.812, steps=600]
Agent gate_2 episode reward: [-13.11184348]
All agents episode reward: [-13.11184348]
Agent gate_2 episode reward: [-11.62291055]
All agents episode reward: [-11.62291055]
Agent gate_2 episode reward: [-9.43461932]
All agents episode reward: [-9.43461932]
Agent gate_2 episode reward: [-10.88245274]
All agents episode reward: [-10.88245274]
Agent gate_2 episode reward: [-11.31934867]
All agents episode reward: [-11.31934867]
Agent gate_2 episode reward: [-8.78909052]
All agents episode reward: [-8.78909052]
Agent gate_2 episode reward: [-10.16206263]
All agents episode reward: [-10.16206263]
Agent gate_2 episode reward: [-11.6554144]
All agents episode reward: [-11.6554144]
Agent gate_2 episode reward: [-15.55408193]
All agents episode reward: [-15.55408193]
Agent gate_2 episode reward: [-14.14331167]
All agents episode reward: [-14.14331167]
Agent gate_2 episode reward: [-14.7573263]
All agents episode reward: [-14.7573263]
Agent gate_2 episode reward: [-11.58346752]
All agents episode reward: [-11.58346752]
Agent gate_2 episode reward: [-12.43698036]
All agents episode reward: [-12.43698036]
Agent gate_2 episode reward: [-14.97808871]
All agents episode reward: [-14.97808871]
Agent gate_2 episode reward: [-13.53975603]
All agents episode reward: [-13.53975603]
Iteration 4: 100%|██████████| 15/15 [00:32<00:00,  2.19s/it, episode=70, norm_ret=-11.596, true_ret=-589396.938, steps=600]
Agent gate_2 episode reward: [-10.91202555]
All agents episode reward: [-10.91202555]
Agent gate_2 episode reward: [-10.71867191]
All agents episode reward: [-10.71867191]
Agent gate_2 episode reward: [-13.04008149]
All agents episode reward: [-13.04008149]
Agent gate_2 episode reward: [-14.37255234]
All agents episode reward: [-14.37255234]
Agent gate_2 episode reward: [-11.629608]
All agents episode reward: [-11.629608]
Agent gate_2 episode reward: [-11.43292946]
All agents episode reward: [-11.43292946]
Agent gate_2 episode reward: [-11.3674618]
All agents episode reward: [-11.3674618]
Agent gate_2 episode reward: [-10.91954858]
All agents episode reward: [-10.91954858]
Agent gate_2 episode reward: [-10.62463701]
All agents episode reward: [-10.62463701]
Agent gate_2 episode reward: [-10.94313021]
All agents episode reward: [-10.94313021]
Agent gate_2 episode reward: [-12.67035652]
All agents episode reward: [-12.67035652]
Agent gate_2 episode reward: [-11.52764264]
All agents episode reward: [-11.52764264]
Agent gate_2 episode reward: [-10.89436995]
All agents episode reward: [-10.89436995]
Agent gate_2 episode reward: [-11.6341902]
All agents episode reward: [-11.6341902]
Agent gate_2 episode reward: [-12.17344633]
All agents episode reward: [-12.17344633]
Iteration 5: 100%|██████████| 15/15 [00:39<00:00,  3.14s/it, episode=85, norm_ret=-12.041, true_ret=-783962.438, steps=600]
Agent gate_2 episode reward: [-13.6513014]
All agents episode reward: [-13.6513014]
Agent gate_2 episode reward: [-10.89125718]
All agents episode reward: [-10.89125718]
Agent gate_2 episode reward: [-10.91745858]
All agents episode reward: [-10.91745858]
Agent gate_2 episode reward: [-11.99591011]
All agents episode reward: [-11.99591011]
Saved 1 agents to ppo_agents_butterfly_scB
[Validation] New best avg return: -710894.812 at episode 80 (over 5 val episodes, saved to ppo_agents_butterfly_scB)
Agent gate_2 episode reward: [-11.54870895]
All agents episode reward: [-11.54870895]
Agent gate_2 episode reward: [-10.65224703]
All agents episode reward: [-10.65224703]
Agent gate_2 episode reward: [-10.43034356]
All agents episode reward: [-10.43034356]
Agent gate_2 episode reward: [-12.14207862]
All agents episode reward: [-12.14207862]
Agent gate_2 episode reward: [-12.62604042]
All agents episode reward: [-12.62604042]
Agent gate_2 episode reward: [-15.55092731]
All agents episode reward: [-15.55092731]
Agent gate_2 episode reward: [-14.36358685]
All agents episode reward: [-14.36358685]
Agent gate_2 episode reward: [-16.04517088]
All agents episode reward: [-16.04517088]
Agent gate_2 episode reward: [-17.54320742]
All agents episode reward: [-17.54320742]
Agent gate_2 episode reward: [-13.14914583]
All agents episode reward: [-13.14914583]
Agent gate_2 episode reward: [-12.38462822]
All agents episode reward: [-12.38462822]
Iteration 6: 100%|██████████| 15/15 [00:37<00:00,  2.57s/it, episode=100, norm_ret=-13.431, true_ret=-758093.000, steps=600]
Agent gate_2 episode reward: [-12.58857973]
All agents episode reward: [-12.58857973]
Agent gate_2 episode reward: [-11.26048496]
All agents episode reward: [-11.26048496]
Agent gate_2 episode reward: [-11.20420858]
All agents episode reward: [-11.20420858]
Agent gate_2 episode reward: [-11.19093541]
All agents episode reward: [-11.19093541]
Agent gate_2 episode reward: [-13.78954498]
All agents episode reward: [-13.78954498]
Agent gate_2 episode reward: [-11.46055804]
All agents episode reward: [-11.46055804]
Agent gate_2 episode reward: [-12.17063368]
All agents episode reward: [-12.17063368]
Agent gate_2 episode reward: [-16.50947931]
All agents episode reward: [-16.50947931]
Agent gate_2 episode reward: [-18.51320532]
All agents episode reward: [-18.51320532]
Saved 1 agents to ppo_agents_butterfly_scB
[Validation] New best avg return: -688409.750 at episode 100 (over 5 val episodes, saved to ppo_agents_butterfly_scB)
Agent gate_2 episode reward: [-15.62288325]
All agents episode reward: [-15.62288325]
Agent gate_2 episode reward: [-14.13277456]
All agents episode reward: [-14.13277456]
Agent gate_2 episode reward: [-12.13605534]
All agents episode reward: [-12.13605534]
Agent gate_2 episode reward: [-11.56469626]
All agents episode reward: [-11.56469626]
Agent gate_2 episode reward: [-12.11840211]
All agents episode reward: [-12.11840211]
Agent gate_2 episode reward: [-12.26216631]
All agents episode reward: [-12.26216631]
Iteration 7: 100%|██████████| 15/15 [00:39<00:00,  2.61s/it, episode=115, norm_ret=-11.206, true_ret=-572262.500, steps=600]
Agent gate_2 episode reward: [-10.71379508]
All agents episode reward: [-10.71379508]
Agent gate_2 episode reward: [-11.27534975]
All agents episode reward: [-11.27534975]
Agent gate_2 episode reward: [-11.79573755]
All agents episode reward: [-11.79573755]
Agent gate_2 episode reward: [-11.02854447]
All agents episode reward: [-11.02854447]
Agent gate_2 episode reward: [-10.62001973]
All agents episode reward: [-10.62001973]
Agent gate_2 episode reward: [-10.94413029]
All agents episode reward: [-10.94413029]
Agent gate_2 episode reward: [-11.53150213]
All agents episode reward: [-11.53150213]
Agent gate_2 episode reward: [-11.47089113]
All agents episode reward: [-11.47089113]
Agent gate_2 episode reward: [-11.08029412]
All agents episode reward: [-11.08029412]
Agent gate_2 episode reward: [-11.59788717]
All agents episode reward: [-11.59788717]
Agent gate_2 episode reward: [-11.74481792]
All agents episode reward: [-11.74481792]
Agent gate_2 episode reward: [-11.16269415]
All agents episode reward: [-11.16269415]
Agent gate_2 episode reward: [-11.20836923]
All agents episode reward: [-11.20836923]
Agent gate_2 episode reward: [-13.74298214]
All agents episode reward: [-13.74298214]
Agent gate_2 episode reward: [-12.13103025]
All agents episode reward: [-12.13103025]
Iteration 8: 100%|██████████| 15/15 [00:36<00:00,  2.45s/it, episode=130, norm_ret=-11.538, true_ret=-552071.312, steps=600]
Agent gate_2 episode reward: [-12.6614429]
All agents episode reward: [-12.6614429]
Agent gate_2 episode reward: [-13.70186904]
All agents episode reward: [-13.70186904]
Agent gate_2 episode reward: [-11.88248764]
All agents episode reward: [-11.88248764]
Agent gate_2 episode reward: [-11.3719338]
All agents episode reward: [-11.3719338]
Agent gate_2 episode reward: [-11.3969014]
All agents episode reward: [-11.3969014]
Agent gate_2 episode reward: [-11.29971586]
All agents episode reward: [-11.29971586]
Agent gate_2 episode reward: [-11.12613518]
All agents episode reward: [-11.12613518]
Agent gate_2 episode reward: [-10.33734795]
All agents episode reward: [-10.33734795]
Agent gate_2 episode reward: [-10.40979356]
All agents episode reward: [-10.40979356]
Agent gate_2 episode reward: [-11.18761592]
All agents episode reward: [-11.18761592]
Agent gate_2 episode reward: [-10.86684855]
All agents episode reward: [-10.86684855]
Agent gate_2 episode reward: [-10.3453621]
All agents episode reward: [-10.3453621]
Agent gate_2 episode reward: [-11.72735071]
All agents episode reward: [-11.72735071]
Agent gate_2 episode reward: [-11.23940968]
All agents episode reward: [-11.23940968]
Agent gate_2 episode reward: [-11.15518412]
All agents episode reward: [-11.15518412]
Iteration 9: 100%|██████████| 15/15 [00:39<00:00,  3.14s/it, episode=145, norm_ret=-12.568, true_ret=-586946.188, steps=600]
Agent gate_2 episode reward: [-12.0815608]
All agents episode reward: [-12.0815608]
Agent gate_2 episode reward: [-10.74330419]
All agents episode reward: [-10.74330419]
Agent gate_2 episode reward: [-14.55150901]
All agents episode reward: [-14.55150901]
Agent gate_2 episode reward: [-12.79449395]
All agents episode reward: [-12.79449395]
Agent gate_2 episode reward: [-11.52764125]
All agents episode reward: [-11.52764125]
Agent gate_2 episode reward: [-12.45526502]
All agents episode reward: [-12.45526502]
Agent gate_2 episode reward: [-14.32102342]
All agents episode reward: [-14.32102342]
Agent gate_2 episode reward: [-13.05344801]
All agents episode reward: [-13.05344801]
Agent gate_2 episode reward: [-12.03012226]
All agents episode reward: [-12.03012226]
Agent gate_2 episode reward: [-12.11888469]
All agents episode reward: [-12.11888469]
Agent gate_2 episode reward: [-12.95750921]
All agents episode reward: [-12.95750921]
Agent gate_2 episode reward: [-12.48445186]
All agents episode reward: [-12.48445186]
Agent gate_2 episode reward: [-11.69452662]
All agents episode reward: [-11.69452662]
Agent gate_2 episode reward: [-11.67367694]
All agents episode reward: [-11.67367694]
Saved 1 agents to ppo_agents_butterfly_scB
[Validation] New best avg return: -576991.688 at episode 150 (over 5 val episodes, saved to ppo_agents_butterfly_scB)
Agent gate_2 episode reward: [-10.9635799]
All agents episode reward: [-10.9635799]
Loaded 1 agents from ppo_agents_butterfly_scB
Running 10 evaluation runs...
  Run 1/10... Avg agent reward (episode): -990426.000 | Total reward: -990426.000
Saved run 1 to rl_training/butterfly_scB/ppo_run1
  Run 2/10... Avg agent reward (episode): -1115881.125 | Total reward: -1115881.125
Saved run 2 to rl_training/butterfly_scB/ppo_run2
  Run 3/10... Avg agent reward (episode): -1151162.250 | Total reward: -1151162.250
Saved run 3 to rl_training/butterfly_scB/ppo_run3
  Run 4/10... Avg agent reward (episode): -1113893.125 | Total reward: -1113893.125
Saved run 4 to rl_training/butterfly_scB/ppo_run4
  Run 5/10... Avg agent reward (episode): -1142845.375 | Total reward: -1142845.375
Saved run 5 to rl_training/butterfly_scB/ppo_run5
  Run 6/10... Avg agent reward (episode): -1150491.125 | Total reward: -1150491.125
Saved run 6 to rl_training/butterfly_scB/ppo_run6
  Run 7/10... Avg agent reward (episode): -1162991.750 | Total reward: -1162991.750
Saved run 7 to rl_training/butterfly_scB/ppo_run7
  Run 8/10... Avg agent reward (episode): -1154796.500 | Total reward: -1154796.500
Saved run 8 to rl_training/butterfly_scB/ppo_run8
  Run 9/10... Avg agent reward (episode): -1149311.625 | Total reward: -1149311.625
Saved run 9 to rl_training/butterfly_scB/ppo_run9
  Run 10/10... Avg agent reward (episode): -1137956.125 | Total reward: -1137956.125
Saved run 10 to rl_training/butterfly_scB/ppo_run10
============================================================
Evaluation Results
  Number of runs: 10
============================================================
  Agent gate_2: -1126975.625 ± 47979.676
  Average reward: -1126975.625 ± 47979.676
  Total reward: -1126975.625 ± 47979.676
============================================================
Running 10 evaluation runs...
  Run 1/10... Avg agent reward (episode): -1033294.000 | Total reward: -1033294.000
Saved run 1 to rl_training/butterfly_scB/rule_based_run1
  Run 2/10... Avg agent reward (episode): -595198.312 | Total reward: -595198.312
Saved run 2 to rl_training/butterfly_scB/rule_based_run2
  Run 3/10... Avg agent reward (episode): -621182.625 | Total reward: -621182.625
Saved run 3 to rl_training/butterfly_scB/rule_based_run3
  Run 4/10... Avg agent reward (episode): -604759.500 | Total reward: -604759.500
Saved run 4 to rl_training/butterfly_scB/rule_based_run4
  Run 5/10... Avg agent reward (episode): -650968.125 | Total reward: -650968.125
Saved run 5 to rl_training/butterfly_scB/rule_based_run5
  Run 6/10... Avg agent reward (episode): -1062296.000 | Total reward: -1062296.000
Saved run 6 to rl_training/butterfly_scB/rule_based_run6
  Run 7/10... Avg agent reward (episode): -625153.500 | Total reward: -625153.500
Saved run 7 to rl_training/butterfly_scB/rule_based_run7
  Run 8/10... Avg agent reward (episode): -1272371.000 | Total reward: -1272371.000
Saved run 8 to rl_training/butterfly_scB/rule_based_run8
  Run 9/10... Avg agent reward (episode): -1067517.500 | Total reward: -1067517.500
Saved run 9 to rl_training/butterfly_scB/rule_based_run9
  Run 10/10... Avg agent reward (episode): -633965.750 | Total reward: -633965.750
Saved run 10 to rl_training/butterfly_scB/rule_based_run10
============================================================
Evaluation Results
  Number of runs: 10
============================================================
  Agent gate_2: -816670.625 ± 246481.953
  Average reward: -816670.625 ± 246481.953
  Total reward: -816670.625 ± 246481.953
============================================================
Running 10 evaluation runs...
  Run 1/10... No actions provided, skipping action application.
Avg agent reward (episode): -770331.875 | Total reward: -770331.875
Saved run 1 to rl_training/butterfly_scB/no_control_run1
  Run 2/10... No actions provided, skipping action application.
Avg agent reward (episode): -984722.812 | Total reward: -984722.812
Saved run 2 to rl_training/butterfly_scB/no_control_run2
  Run 3/10... No actions provided, skipping action application.
Avg agent reward (episode): -1068342.500 | Total reward: -1068342.500
Saved run 3 to rl_training/butterfly_scB/no_control_run3
  Run 4/10... No actions provided, skipping action application.
Avg agent reward (episode): -985402.750 | Total reward: -985402.750
Saved run 4 to rl_training/butterfly_scB/no_control_run4
  Run 5/10... No actions provided, skipping action application.
Avg agent reward (episode): -1065561.000 | Total reward: -1065561.000
Saved run 5 to rl_training/butterfly_scB/no_control_run5
  Run 6/10... No actions provided, skipping action application.
Avg agent reward (episode): -1065266.875 | Total reward: -1065266.875
Saved run 6 to rl_training/butterfly_scB/no_control_run6
  Run 7/10... No actions provided, skipping action application.
Avg agent reward (episode): -1072243.250 | Total reward: -1072243.250
Saved run 7 to rl_training/butterfly_scB/no_control_run7
  Run 8/10... No actions provided, skipping action application.
Avg agent reward (episode): -1056412.750 | Total reward: -1056412.750
Saved run 8 to rl_training/butterfly_scB/no_control_run8
  Run 9/10... No actions provided, skipping action application.
Avg agent reward (episode): -1060676.125 | Total reward: -1060676.125
Saved run 9 to rl_training/butterfly_scB/no_control_run9
  Run 10/10... No actions provided, skipping action application.
Avg agent reward (episode): -1073660.250 | Total reward: -1073660.250
Saved run 10 to rl_training/butterfly_scB/no_control_run10
============================================================
Evaluation Results
  Number of runs: 10
============================================================
  Agent gate_2: -1020262.000 ± 89345.430
  Average reward: -1020262.000 ± 89345.430
  Total reward: -1020262.000 ± 89345.430
============================================================

============================================================
Comparison of All Methods
============================================================
ppo avg reward:        -1126975.625
Rule-based avg reward: -816670.625
No control avg reward: -1020262.000
============================================================
/Users/mmai/anaconda3/envs/control/lib/python3.11/site-packages/matplotlib/patches.py:3421: RuntimeWarning: invalid value encountered in scalar divide
  cos_t, sin_t = head_length / head_dist, head_width / head_dist
